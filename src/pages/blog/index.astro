---
// src/pages/blog/index.astro
import BaseLayout from '@/layouts/BaseLayout.astro';
import PostCard from '@/components/PostCard.astro';
import { getCollection } from 'astro:content';

// Coacción segura de fecha
const toTime = (d: unknown): number => {
  if (d instanceof Date) return d.getTime();
  if (typeof d === 'string' && d) {
    const t = new Date(d).getTime();
    return Number.isNaN(t) ? 0 : t;
  }
  return 0;
};

// Posts más recientes primero
const posts = (await getCollection('blog')).sort(
  (a, b) => toTime(b.data?.date) - toTime(a.data?.date)
);

// Muestra hasta 9 (ajusta si quieres)
const VISIBLE = 9;
const totalPages = Math.max(1, Math.ceil(posts.length / VISIBLE));
---

<BaseLayout title="Blog" description="Artículos sobre Salesforce, Astro, DevOps y más.">
  <section class="container section">
    <header class="section__header">
      <h1 class="h1">Blog</h1>
      <p class="lead">Últimos artículos, ordenados del más nuevo al más antiguo.</p>
    </header>

    <div class="posts-grid">
      {posts.slice(0, VISIBLE).map((entry) => (<PostCard entry={entry} />))}
    </div>

    {totalPages > 1 && (
      <nav class="pagination" aria-label="Paginación del blog">
        <a href="/blog/pages/2">Siguiente →</a>
      </nav>
    )}
  </section>
</BaseLayout>
