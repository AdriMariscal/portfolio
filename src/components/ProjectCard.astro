---
import type { CollectionEntry } from 'astro:content';

type WithEntry = {
  entry: CollectionEntry<'projects'>;
  href?: string; // permite forzar href si quieres
};

type WithProps = {
  entry?: undefined;
  title: string;
  description?: string;
  tags?: string[];
  repoUrl?: string;
  demoUrl?: string;
  href: string; // obligatorio cuando no hay entry
};

const props = Astro.props as WithEntry | WithProps;

// Normaliza datos: usa entry si llega; si no, usa props sueltas
let title: string;
let description = '';
let tags: string[] = [];
let repo = '';
let demo = '';
let status = '';
let slugHref = '#';

if ('entry' in props && props.entry) {
  const { data, slug } = props.entry;
  title = data.title ?? 'Proyecto sin título';
  description = data.description ?? '';
  tags = Array.isArray(data.tags) ? data.tags : [];
  repo = (data as any).repoUrl ?? '';
  demo = (data as any).demoUrl ?? '';
  status = (data as any).status ?? '';
  slugHref = props.href ?? `/projects/${slug}`;
} else {
  // props sueltas
  title = props.title;
  description = props.description ?? '';
  tags = props.tags ?? [];
  repo = props.repoUrl ?? '';
  demo = props.demoUrl ?? '';
  status = '';
  slugHref = props.href;
}
---

<article class="project-card">
  <header>
    <h3><a href={slugHref}>{title}</a></h3>
    {status && <span class="badge">{status}</span>}
  </header>

  {description && <p class="desc">{description}</p>}

  {(repo || demo || tags.length) && (
    <footer class="meta">
      <ul class="links">
        {repo && <li><a href={repo} target="_blank" rel="noopener">Código</a></li>}
        {demo && <li><a href={demo} target="_blank" rel="noopener">Demo</a></li>}
      </ul>
      {tags.length ? <ul class="tags">{tags.map((t) => <li>#{t}</li>)}</ul> : null}
    </footer>
  )}
</article>

<style>
.project-card{border:1px solid #e5e7eb; border-radius:12px; padding:16px; background:#fff;}
.project-card header{display:flex; gap:8px; align-items:center; justify-content:space-between;}
.project-card h3{margin:0; font-family:var(--font-display,'Sora'); font-weight:600; color:var(--am-ink,#0B1F3B);}
.badge{border-radius:9999px; padding:2px 8px; font-size:12px; border:1px solid var(--am-accent,#21B6A8); color:var(--am-graphite,#162433);}
.desc{margin:8px 0 12px; color:#333;}
.meta{display:flex; justify-content:space-between; align-items:center; gap:8px;}
.links,.tags{display:flex; gap:10px; list-style:none; margin:0; padding:0;}
.links a{text-decoration:none;}
.links a:hover{text-decoration:underline;}
.tags li{font-size:12px; color:var(--am-graphite,#162433);}
</style>
